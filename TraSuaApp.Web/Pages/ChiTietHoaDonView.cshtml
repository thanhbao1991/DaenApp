@model TraSuaAppWeb.Pages.ChiTietHoaDonModel

<div class="modal-header">
    <button type="button" class="btn btn-light" onclick="captureImage()">
        &#x1F4F7; LÆ°u HÃ¬nh áº¢nh
    </button>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div id="imagePreview" style="margin-top: 10px;"></div>

<div id="modalContent" class="mt-4 p-3 border rounded bg-light" style="background:#f9f9f9; font-size: 0.9rem;">
    @for (int i = 0; i < Model.ChiTietHoaDonList.Count; i++)
    {
        var item = Model.ChiTietHoaDonList[i];

        string GetSoLuongIcon(int so)
        {
            var icons = new[] {
        "\u0030\uFE0F\u20E3", "\u0031\uFE0F\u20E3", "\u0032\uFE0F\u20E3", "\u0033\uFE0F\u20E3", "\u0034\uFE0F\u20E3",
        "\u0035\uFE0F\u20E3", "\u0036\uFE0F\u20E3", "\u0037\uFE0F\u20E3", "\u0038\uFE0F\u20E3", "\u0039\uFE0F\u20E3"
        };
            if (so == 10) return "\uD83D\uDD1F"; // ðŸŸŸ
            if (so < 10) return icons[so];
            return string.Concat(so.ToString().Select(c => icons[int.Parse(c.ToString())]));
        }

        var iconSo = GetSoLuongIcon((int)item.SoLuong);
        var iconLoa = item.DonGia == 1 ? "\uD83D\uDD08" : (item.DonGia == 0 ? "âœ…" : "");
        bool anSoLuongVaTien = item.DonGia == 0 || item.DonGia == 1;

        <div
            class="mx-3 d-flex justify-content-between align-items-center item-row py-2 @(item.ThanhTien == 0 ? "opacity-25" : "")">
            <div>
                <span class="item-text">
                    @if (!anSoLuongVaTien)
                    {
                        @iconSo
                    }
                    @iconLoa @item.TenSanPham
                </span>
                @if (!string.IsNullOrEmpty(item.GhiChu))
                {
                    <div class="item-note">@item.GhiChu</div>
                }
            </div>
            @if (!anSoLuongVaTien)
            {
                <span class="fw-bold text-danger">@item.ThanhTien.ToString("N0")</span>
            }
        </div>
    }

    <div class="border-top mt-4 pt-2 d-flex justify-content-between fw-bold text-danger">
        <span>Tá»•ng</span>
        <span>@Model.ChiTietHoaDonList.Sum(x => x.ThanhTien).ToString("N0") Ä‘</span>
    </div>
</div>

@if (Model.flag == 1)
{
    <div class="d-flex justify-content-end mt-4 gap-2">
        <button class="btn btn-warning" onclick="capNhatBanking(@Model.IdHoaDon)">
            &#x1F4B3; Banking
        </button>
        @* <button class="btn btn-danger" onclick="capNhatNo(@Model.IdHoaDon)">
            &#x1F4DD; Ghi ná»£
        </button> *@
    </div>
}
<form method="post" style="display:none">
    @Html.AntiForgeryToken()
</form>
<style>
    .item-row {
        font-size: 0.95rem;
    }

    .item-text {
        display: inline-flex;
        align-items: center;
        gap: 0.4em;
        line-height: 1.4;
    }

    .item-note {
        font-size: 0.85em;
        opacity: 0.5;
        padding-left: 2em;
        line-height: 1.2;
    }
</style>
