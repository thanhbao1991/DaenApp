@{
    var displayName = Context.Request.Cookies["display_name"];
}

@functions {
    string Active(string page) =>
        (ViewContext.RouteData.Values["page"] as string)?.Equals(page, StringComparison.OrdinalIgnoreCase) == true
        ? "active"
        : "";
}

<style>
    .icon-bar {
        display: flex;
        align-items: center;
        gap: .4rem;
        flex-wrap: wrap;
        margin: 0;
        padding: 0;
        list-style: none;
    }

        .icon-bar .nav-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: .5rem;
            transition: background-color .15s ease, border-color .15s ease;
        }

            .icon-bar .nav-link:hover {
                background: rgba(0,0,0,.06);
            }
            /* Hiển thị active */
            .icon-bar .nav-link.active {
                background: #e9ecef !important;
                border: 1px solid #cbd3da;
            }
            /* Ẩn text nếu có */
            .icon-bar .nav-link span {
                display: none !important;
            }
</style>

<nav class="navbar navbar-light bg-white border-bottom mb-3">
    <div class="container-fluid">

        <ul class="icon-bar">

            <!-- (1) Tạo Hóa Đơn -->
            <li class="nav-item">
                <a class="nav-link @Active("/CreatePlus")"
                   asp-page="/CreatePlus" title="Tạo Hóa Đơn">
                    <i class="fa-solid fa-plus-circle text-secondary"></i>
                </a>
            </li>

            <!-- (2) Thống kê -->
            <li class="nav-item">
                <a class="nav-link @Active("/ThongKe")"
                   asp-page="/ThongKe" title="Thống kê">
                    <i class="fa-solid fa-chart-pie text-info"></i>
                </a>
            </li>

            <!-- (3) Doanh thu ngày -->
            <li class="nav-item">
                <a class="nav-link @Active("/DoanhThuNgay")"
                   asp-page="/DoanhThuNgay" title="Doanh Thu Ngày">
                    <i class="fa-solid fa-coins text-success"></i>
                </a>
            </li>

            <!-- (4) Thanh toán -->
            <li class="nav-item">
                <a class="nav-link @Active("/ChiTietHoaDonThanhToanTab")"
                   asp-page="/ChiTietHoaDonThanhToanTab" title="Thanh Toán">
                    <i class="fa-solid fa-credit-card text-success"></i>
                </a>
            </li>

            <!-- (5) Công nợ -->
            <li class="nav-item">
                <a class="nav-link @Active("/ChiTietHoaDonNoTab")"
                   asp-page="/ChiTietHoaDonNoTab" title="Công Nợ">
                    <i class="fa-solid fa-file-invoice-dollar text-warning"></i>
                </a>
            </li>

            <!-- (6) Chi tiêu -->
            <li class="nav-item">
                <a class="nav-link @Active("/ChiTieuHangNgayTab")"
                   asp-page="/ChiTieuHangNgayTab" title="Chi Tiêu">
                    <i class="fa-solid fa-wallet text-danger"></i>
                </a>
            </li>

            <!-- (7) Công việc -->
            <li class="nav-item">
                <a class="nav-link @Active("/CongViecNoiBoTab")"
                   asp-page="/CongViecNoiBoTab" title="Công Việc">
                    <i class="fa-solid fa-tasks text-primary"></i>
                </a>
            </li>


            <!-- (8) Nhóm 2 -->
            <li class="nav-item dropdown">
                <a class="nav-link" href="#" id="moreDropdown" role="button"
                   data-bs-toggle="dropdown" title="Mở rộng">
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="moreDropdown">

                    <li class="dropdown-header">Doanh thu</li>
                    <li><a class="dropdown-item" asp-page="/DoanhThuThang">Doanh Thu Tháng</a></li>

                    <li><hr class="dropdown-divider" /></li>

                    <li class="dropdown-header">Xếp hạng</li>
                    <li><a class="dropdown-item" asp-page="/XepHangSanPham">TOP Sản phẩm</a></li>
                    <li><a class="dropdown-item" asp-page="/XepHangKhachHang">TOP Khách hàng</a></li>

                    <li><hr class="dropdown-divider" /></li>

                    <li class="dropdown-header">Mở rộng</li>
                    <li><a class="dropdown-item" asp-page="/VoucherTab">Voucher</a></li>
                    <li><a class="dropdown-item" asp-page="/ChiTieuTab">Ứng Nhã</a></li>

                    <li><hr class="dropdown-divider" /></li>

                    <!-- Logout cuối -->
                    @if (!string.IsNullOrWhiteSpace(displayName))
                    {
                        <li>
                            <form asp-page="/Login" asp-page-handler="Logout" method="post" class="dropdown-item p-0">
                                <button type="submit" class="btn btn-link dropdown-item text-danger text-start">
                                    <i class="fa-solid fa-right-from-bracket me-2"></i>
                                    Đăng xuất @displayName
                                </button>
                            </form>
                        </li>
                    }
                    else
                    {
                        <li>
                            <a class="dropdown-item" asp-page="/Login">
                                <i class="fa-solid fa-right-to-bracket me-2"></i>
                                Đăng nhập
                            </a>
                        </li>
                    }
                </ul>
            </li>

        </ul>
    </div>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.dropdown-menu .dropdown-item')
            .forEach(item => {
                item.addEventListener('click', () => {
                    const dd = bootstrap.Dropdown.getInstance(document.getElementById('moreDropdown'));
                    if (dd) dd.hide();
                });
            });
    });
</script>